<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Photo Enhancement - MagicPlate.ai</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', sans-serif;
      background: #f5f5f5;
      color: #1a1a1a;
      padding: 20px;
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-text-size-adjust: 100%;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #4caf50;
      text-decoration: none;
      font-weight: 500;
      margin-bottom: 16px;
      font-size: 0.95em;
    }
    
    .header {
      background: white;
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .header h1 {
      color: #4caf50;
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    
    .header p {
      color: #666;
      font-size: 1.1em;
    }
    
    .upload-section {
      background: white;
      padding: 40px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .upload-zone {
      border: 3px dashed #4caf50;
      border-radius: 15px;
      padding: 60px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: rgba(76, 175, 80, 0.05);
    }
    
    .upload-zone:hover {
      background: rgba(76, 175, 80, 0.1);
      border-color: #66bb6a;
    }
    
    .upload-zone.dragover {
      background: rgba(76, 175, 80, 0.15);
      border-color: #4caf50;
      transform: scale(1.02);
    }
    
    .upload-icon {
      font-size: 4em;
      margin-bottom: 20px;
      color: #4caf50;
    }
    
    .upload-text {
      font-size: 1.2em;
      color: #1a1a1a;
      margin-bottom: 10px;
    }
    
    .upload-hint {
      color: #666;
      font-size: 0.9em;
    }
    
    #fileInput {
      display: none;
    }
    
    .preview-section {
      background: white;
      padding: 40px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      display: none;
    }
    
    .preview-section.active {
      display: block;
    }
    
    /* Before/After Slider Styles */
    .before-after-container {
      position: relative;
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      background: #000;
    }
    
    .before-after-wrapper {
      position: relative;
      width: 100%;
      padding-bottom: 75%; /* 4:3 aspect ratio */
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      cursor: col-resize;
    }
    
    .before-image,
    .after-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      user-select: none;
      -webkit-user-select: none;
      pointer-events: none;
    }
    
    .after-image {
      clip-path: inset(0 50% 0 0);
      transition: clip-path 0.1s ease-out;
    }
    
    .slider-control {
      position: absolute;
      top: 0;
      left: 50%;
      width: 4px;
      height: 100%;
      background: #4caf50;
      cursor: col-resize;
      z-index: 10;
      transform: translateX(-50%);
      box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
      pointer-events: auto;
      user-select: none;
      -webkit-user-select: none;
    }
    
    .slider-handle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 55px;
      height: 55px;
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      border: 4px solid white;
      border-radius: 50%;
      cursor: grab;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: transform 0.2s ease;
      z-index: 20;
      pointer-events: auto;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      touch-action: none;
    }
    
    .slider-handle:active,
    .slider-handle.dragging {
      cursor: grabbing;
      transform: translate(-50%, -50%) scale(1.15);
      box-shadow: 0 6px 25px rgba(76, 175, 80, 0.6);
    }
    
    .after-image {
      transition: clip-path 0.05s ease-out;
    }
    
    .after-image.no-transition {
      transition: none;
    }
    
    .slider-icon {
      color: white;
      font-size: 1.5em;
      font-weight: bold;
    }
    
    .before-after-labels {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      padding: 0 30px;
      z-index: 5;
      pointer-events: none;
    }
    
    .label-before,
    .label-after {
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .label-after {
      background: rgba(212, 175, 55, 0.95); /* Golden yellow like homepage */
      color: white;
    }
    
    .processing {
      text-align: center;
      padding: 40px;
    }
    
    .spinner {
      border: 4px solid rgba(76, 175, 80, 0.2);
      border-top: 4px solid #4caf50;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .processing-text {
      color: #4caf50;
      font-size: 1.2em;
      font-weight: 600;
    }
    
    .processing-subtext {
      color: #666;
      margin-top: 10px;
      font-size: 0.95em;
    }
    
    .actions {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      justify-content: center;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
      font-size: 1em;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }
    
    .btn-secondary {
      background: white;
      color: #4caf50;
      border: 2px solid #4caf50;
    }
    
    .btn-secondary:hover {
      background: #4caf50;
      color: white;
    }
    
    .status {
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      display: none;
      text-align: center;
    }
    
    .status.success {
      background: rgba(76, 175, 80, 0.1);
      color: #4caf50;
      border: 2px solid rgba(76, 175, 80, 0.3);
    }
    
    .status.error {
      background: rgba(245, 158, 11, 0.1);
      color: #f59e0b;
      border: 2px solid rgba(245, 158, 11, 0.3);
    }
    
    .info-box {
      background: rgba(76, 175, 80, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      border-left: 4px solid #4caf50;
    }
    
    .info-box h3 {
      color: #4caf50;
      margin-bottom: 10px;
    }
    
    .info-box p {
      color: #666;
      line-height: 1.6;
    }

    /* ‚îÄ‚îÄ Trial Banner ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .trial-banner {
      background: linear-gradient(135deg, #fff3e0, #fff8e1);
      border: 1px solid #ffe0b2;
      border-radius: 12px;
      padding: 14px 20px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .trial-banner-text {
      font-size: 0.92em;
      color: #e65100;
      font-weight: 600;
    }
    .trial-banner-text span {
      font-weight: 800;
      color: #bf360c;
    }

    /* ‚îÄ‚îÄ Signup Gate Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .gate-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      backdrop-filter: blur(8px);
      z-index: 99999;
      align-items: center;
      justify-content: center;
    }
    .gate-overlay.active { display: flex; }
    .gate-card {
      background: white;
      border-radius: 20px;
      padding: 48px;
      max-width: 480px;
      width: 92%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.25);
      position: relative;
      animation: gateSlideIn 0.35s ease-out;
    }
    @keyframes gateSlideIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .gate-card h2 {
      font-size: 1.7em;
      font-weight: 800;
      margin-bottom: 10px;
      color: #1a1a1a;
    }
    .gate-card > p {
      color: #666;
      margin-bottom: 24px;
      font-size: 1.05em;
      line-height: 1.5;
    }
    .gate-close {
      position: absolute;
      top: 14px;
      right: 18px;
      background: none;
      border: none;
      font-size: 26px;
      cursor: pointer;
      color: #999;
      transition: color 0.2s;
    }
    .gate-close:hover { color: #333; }
    .gate-form { text-align: left; }
    .gate-form label {
      display: block;
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 14px;
      color: #333;
    }
    .gate-form input, .gate-form select {
      width: 100%;
      padding: 12px;
      border: 2px solid #eee;
      border-radius: 10px;
      font-size: 15px;
      margin-bottom: 14px;
      transition: border-color 0.3s;
      font-family: inherit;
    }
    .gate-form input:focus, .gate-form select:focus {
      border-color: #4caf50;
      outline: none;
    }
    .gate-submit {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg,#4caf50,#66bb6a);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 6px;
      font-family: inherit;
    }
    .gate-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(76,175,80,0.35);
    }
    .gate-success {
      display: none;
      text-align: center;
      padding: 20px;
    }
    .gate-success h3 {
      color: #4caf50;
      font-size: 1.4em;
      margin-bottom: 8px;
    }
    .gate-success-icon {
      font-size: 3em;
      margin-bottom: 12px;
    }
    .gate-success-text {
      color: #666;
      line-height: 1.5;
    }
    .gate-success-btn {
      margin-top: 16px;
    }
    
    .preview-container {
      display: none;
      margin-top: 20px;
    }

    .preview-image {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    /* ‚îÄ‚îÄ Fictional Control (proper classes instead of inline) ‚îÄ‚îÄ */
    .fictional-control {
      margin: 20px 0;
      padding: 20px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .fictional-control label {
      display: block;
      margin-bottom: 12px;
      font-weight: 600;
      color: #333;
      font-size: 0.95em;
    }
    .fictional-label {
      color: #4CAF50;
      font-weight: 700;
    }
    .preset-row {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .preset-btn {
      flex: 1;
      min-width: 80px;
      padding: 8px 12px;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85em;
      font-weight: 600;
      transition: all 0.2s;
      font-family: inherit;
    }
    .preset-btn[data-level="20"] { background: #4CAF50; }
    .preset-btn[data-level="50"] { background: #FF9800; }
    .preset-btn[data-level="85"] { background: #F44336; }
    .fictional-slider {
      width: 100%;
      height: 10px;
      border-radius: 5px;
      outline: none;
      background: linear-gradient(to right, #4CAF50 0%, #FF9800 50%, #F44336 100%);
      -webkit-appearance: none;
      appearance: none;
    }
    .slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 0.8em;
      color: #666;
    }
    .fictional-desc {
      margin-top: 10px;
      font-size: 0.85em;
      color: #555;
      text-align: center;
      font-style: italic;
    }
    .enhance-actions {
      text-align: center;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .identified-banner {
      display: none;
      background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
      border: 1px solid #c8e6c9;
      border-radius: 10px;
      padding: 14px 18px;
      margin-bottom: 15px;
    }
    .identified-banner-title {
      font-weight: 600;
      color: #2e7d32;
      margin-bottom: 4px;
    }
    .identified-banner-text {
      color: #333;
      font-size: 0.95em;
      line-height: 1.4;
    }

    /* ‚îÄ‚îÄ Mobile Responsive ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    @media (max-width: 768px) {
      body {
        padding: 12px 10px;
        -webkit-overflow-scrolling: touch;
        overflow-x: hidden;
      }

      .container {
        max-width: 100%;
      }

      /* Back link */
      .back-link {
        font-size: 0.85em;
        margin-bottom: 10px;
      }

      /* Header */
      .header {
        padding: 18px 16px;
        border-radius: 12px;
        margin-bottom: 16px;
      }
      .header h1 {
        font-size: 1.5em;
        line-height: 1.2;
      }
      .header p {
        font-size: 0.92em;
        line-height: 1.4;
      }

      /* Trial banner */
      .trial-banner {
        padding: 10px 14px;
        margin-bottom: 14px;
        border-radius: 10px;
        flex-wrap: wrap;
      }
      .trial-banner-text {
        font-size: 0.82em;
        line-height: 1.3;
      }

      /* Upload section */
      .upload-section {
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 16px;
      }
      .upload-zone {
        padding: 32px 16px;
        border-radius: 12px;
        border-width: 2px;
      }
      .upload-icon {
        font-size: 2.8em;
        margin-bottom: 12px;
      }
      .upload-text {
        font-size: 1em;
        margin-bottom: 6px;
      }
      .upload-hint {
        font-size: 0.82em;
      }

      /* Preview container & image */
      .preview-container {
        margin-top: 14px;
      }
      .preview-image {
        border-radius: 8px;
        margin-bottom: 14px;
      }

      /* Fictional control */
      .fictional-control {
        margin: 14px 0;
        padding: 14px;
        border-radius: 10px;
      }
      .fictional-control label {
        font-size: 0.88em;
        margin-bottom: 10px;
      }
      .preset-row {
        gap: 6px;
        margin-bottom: 10px;
      }
      .preset-btn {
        padding: 10px 8px;
        font-size: 0.82em;
        border-radius: 8px;
        min-width: 70px;
      }
      .slider-labels {
        font-size: 0.72em;
        margin-top: 6px;
      }
      .fictional-desc {
        font-size: 0.78em;
        margin-top: 8px;
      }

      /* Enhance / Remove buttons */
      .enhance-actions {
        flex-direction: column;
        gap: 8px;
      }
      .enhance-actions .btn {
        width: 100%;
        padding: 14px 20px;
        font-size: 1em;
        border-radius: 10px;
      }

      /* Preview section */
      .preview-section {
        padding: 14px;
        border-radius: 12px;
        margin-bottom: 16px;
      }

      /* Processing */
      .processing {
        padding: 24px 12px;
      }
      .spinner {
        width: 44px;
        height: 44px;
        border-width: 3px;
        margin-bottom: 14px;
      }
      .processing-text {
        font-size: 1em;
      }

      /* Identified items banner */
      .identified-banner {
        padding: 10px 14px;
        border-radius: 8px;
        margin-bottom: 12px;
      }
      .identified-banner-title {
        font-size: 0.88em;
      }
      .identified-banner-text {
        font-size: 0.85em;
      }

      /* Before/after slider */
      .before-after-container {
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      }
      .before-after-wrapper {
        padding-bottom: 100%; /* Square on mobile for better fit */
      }
      .slider-handle {
        width: 44px;
        height: 44px;
        border-width: 3px;
      }
      .slider-icon {
        font-size: 1.2em;
      }
      .before-after-labels {
        bottom: 12px;
        padding: 0 12px;
      }
      .label-before,
      .label-after {
        padding: 5px 10px;
        font-size: 0.72em;
        border-radius: 14px;
        letter-spacing: 0.3px;
      }

      /* Action buttons (download / enhance another) */
      .actions {
        flex-direction: column;
        gap: 10px;
        margin-top: 18px;
      }
      .btn {
        width: 100%;
        padding: 14px 20px;
        font-size: 1em;
        border-radius: 10px;
        text-align: center;
      }

      /* Status message */
      .status {
        padding: 12px;
        border-radius: 8px;
        margin-top: 14px;
        font-size: 0.9em;
        line-height: 1.4;
      }

      /* Info box */
      .info-box {
        padding: 16px;
        border-radius: 10px;
        margin-top: 16px;
      }
      .info-box h3 {
        font-size: 1em;
        margin-bottom: 8px;
      }
      .info-box p {
        font-size: 0.88em;
        line-height: 1.5;
      }

      /* Gate modal */
      .gate-card {
        padding: 24px 20px;
        border-radius: 16px;
        width: 94%;
        max-width: 400px;
        max-height: 90vh;
        overflow-y: auto;
      }
      .gate-card h2 {
        font-size: 1.3em;
        margin-bottom: 8px;
      }
      .gate-card > p {
        font-size: 0.92em;
        margin-bottom: 18px;
      }
      .gate-close {
        top: 10px;
        right: 14px;
        font-size: 24px;
      }
      .gate-form label {
        font-size: 13px;
        margin-bottom: 3px;
      }
      .gate-form input,
      .gate-form select {
        padding: 11px;
        font-size: 14px;
        margin-bottom: 12px;
        border-radius: 8px;
      }
      .gate-submit {
        padding: 13px;
        font-size: 15px;
        border-radius: 10px;
      }
    }

    /* Extra small screens (iPhone SE, small Androids) */
    @media (max-width: 380px) {
      body {
        padding: 8px 6px;
      }
      .header {
        padding: 14px 12px;
      }
      .header h1 {
        font-size: 1.3em;
      }
      .header p {
        font-size: 0.85em;
      }
      .upload-section {
        padding: 12px;
      }
      .upload-zone {
        padding: 24px 12px;
      }
      .upload-icon {
        font-size: 2.2em;
        margin-bottom: 8px;
      }
      .fictional-control {
        padding: 10px;
      }
      .preset-btn {
        min-width: 60px;
        padding: 9px 6px;
        font-size: 0.78em;
      }
      .preview-section {
        padding: 10px;
      }
      .gate-card {
        padding: 20px 16px;
      }
      .gate-card h2 {
        font-size: 1.15em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/features.html" class="back-link">‚Üê Back to Features</a>

    <!-- Trial Banner -->
    <div class="trial-banner" id="trialBanner">
      <span class="trial-banner-text" id="trialBannerText">üéâ <span>1 Free Enhancement</span> ‚Äî Try our AI photo magic, no sign-up needed!</span>
    </div>

    <div class="header">
      <h1>‚ú® AI Photo Enhancement</h1>
      <p>Transform your menu photos with ethical AI enhancement. Make your real food photos pop without fakes.</p>
    </div>
    
    <div class="upload-section">
      <div class="upload-zone" id="uploadZone">
        <div class="upload-icon">üì∏</div>
        <div class="upload-text">Drag & drop your photo here</div>
        <div class="upload-hint">or click to browse (JPG/PNG, max 10MB)</div>
        <input type="file" id="fileInput" accept="image/jpeg,image/png" />
      </div>
      
      <div id="previewContainer" class="preview-container">
        <img id="previewImage" class="preview-image" alt="Preview" />
        
        <!-- Fiction Level Control -->
        <div class="fictional-control">
          <label for="fictionalLevel">
            Creative Intensity: 
            <span id="fictionalLabel" class="fictional-label">Authentic (30%)</span>
          </label>
          
          <!-- Preset Buttons -->
          <div class="preset-row">
            <button type="button" class="preset-btn" data-level="20">Authentic</button>
            <button type="button" class="preset-btn" data-level="50">Balanced</button>
            <button type="button" class="preset-btn" data-level="85">Magical</button>
          </div>
          
          <!-- Slider -->
          <input 
            type="range" 
            id="fictionalLevel" 
            min="0" 
            max="100" 
            value="30" 
            class="fictional-slider"
          />
          <div class="slider-labels">
            <span>0% Real</span>
            <span>50% Balanced</span>
            <span>100% Fictional</span>
          </div>
          <p id="fictionalDescription" class="fictional-desc">
            Enhance food quality while keeping original background
          </p>
        </div>
        
        <div class="enhance-actions">
          <button class="btn btn-primary" id="enhanceBtn">‚ú® Enhance Photo</button>
          <button class="btn btn-secondary" id="removeBtn">Remove</button>
        </div>
      </div>
      
      <div id="status" class="status"></div>
    </div>
    
    <div class="preview-section" id="previewSection">
      <div class="processing" id="processingDiv" style="display: none;">
        <div class="spinner"></div>
        <div class="processing-text" id="processingText">Enhancing your photo...</div>
        <p id="processingSubtext" class="processing-subtext">This may take 15-30 seconds</p>
      </div>

      <!-- Shows after enhancement is complete ‚Äî what the AI identified -->
      <div id="identifiedItemsBanner" class="identified-banner">
        <div class="identified-banner-title">üîç Detected Food Items</div>
        <div id="identifiedItemsText" class="identified-banner-text"></div>
      </div>
      
      <div class="before-after-container" id="sliderContainer" style="display: none;">
        <div class="before-after-wrapper" id="sliderWrapper">
          <img id="beforeImage" class="before-image" alt="Before" />
          <img id="afterImage" class="after-image" alt="After" />
          <div class="slider-control" id="sliderControl">
            <div class="slider-handle" id="sliderHandle">
              <span class="slider-icon" id="sliderIcon">‚Üî</span>
            </div>
          </div>
          <div class="before-after-labels">
            <span class="label-after">After</span>
            <span class="label-before">Before</span>
          </div>
        </div>
      </div>
      
      <div class="actions" id="actionsDiv" style="display: none;">
        <button class="btn btn-primary" id="downloadBtn">‚¨á Download Enhanced</button>
        <button class="btn btn-secondary" id="newPhotoBtn">üì∏ Enhance Another</button>
      </div>
    </div>
    
    <div class="info-box">
      <h3>‚≠ê Michelin-Star Quality</h3>
      <p><strong>What we do:</strong> Transform your food photos into 5-star restaurant quality ‚Äî professional lighting, razor-sharp textures, rich colors, and stunning composition.</p>
      <p><strong>Your food stays your food:</strong> Our AI identifies every item in your photo first, then enhances the quality without changing a single dish. A burger stays a burger ‚Äî just a gorgeous one.</p>
    </div>
  </div>
  
  <script>
    // State management
    let currentFile = null;
    let beforeImageUrl = null;
    let afterImageUrl = null;
    
    // Fiction Level state
    let fictionalLevel = parseInt(localStorage.getItem('fictionalLevel') || '30'); // Default 30%
    let regenerationTimeout = null;
    let isRegenerating = false;

    // Two-step flow state (identify ‚Üí confirm ‚Üí enhance)
    let pendingBase64 = null;
    let confirmedItems = '';
    
    // Slider state management
    let sliderInitialized = false;
    let sliderEventHandlers = {};
    let currentSliderPosition = 50;
    let isDragging = false;
    
    // DOM elements
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const previewContainer = document.getElementById('previewContainer');
    const previewImage = document.getElementById('previewImage');
    const enhanceBtn = document.getElementById('enhanceBtn');
    const removeBtn = document.getElementById('removeBtn');
    const fictionalLevelSlider = document.getElementById('fictionalLevel');
    const fictionalLabel = document.getElementById('fictionalLabel');
    const fictionalDescription = document.getElementById('fictionalDescription');
    const presetButtons = document.querySelectorAll('.preset-btn');
    const statusDiv = document.getElementById('status');
    const previewSection = document.getElementById('previewSection');
    const processingDiv = document.getElementById('processingDiv');
    const sliderContainer = document.getElementById('sliderContainer');
    const beforeImage = document.getElementById('beforeImage');
    const afterImage = document.getElementById('afterImage');
    const actionsDiv = document.getElementById('actionsDiv');
    const downloadBtn = document.getElementById('downloadBtn');
    const newPhotoBtn = document.getElementById('newPhotoBtn');
    const sliderControl = document.getElementById('sliderControl');
    const sliderHandle = document.getElementById('sliderHandle');
    const sliderWrapper = document.getElementById('sliderWrapper');
    
    // Upload zone click
    uploadZone.addEventListener('click', () => fileInput.click());
    
    // Drag and drop
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('dragover');
    });
    
    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('dragover');
    });
    
    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFile(files[0]);
      }
    });
    
    // File input change
    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleFile(e.target.files[0]);
      }
    });
    
    // Handle file selection
    function handleFile(file) {
      // Validate file type
      if (!file.type.match(/^image\/(jpeg|png)$/)) {
        showStatus('Please upload a JPG or PNG image.', 'error');
        return;
      }
      
      // Validate file size (10MB)
      if (file.size > 10 * 1024 * 1024) {
        showStatus('Image too large. Maximum size: 10MB', 'error');
        return;
      }
      
      currentFile = file;
      
      // Show preview
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImage.src = e.target.result;
        previewContainer.style.display = 'block';
        beforeImageUrl = e.target.result;
      };
      reader.readAsDataURL(file);
    }
    
    // Remove preview
    removeBtn.addEventListener('click', () => {
      currentFile = null;
      beforeImageUrl = null;
      afterImageUrl = null;
      pendingBase64 = null;
      confirmedItems = '';
      previewContainer.style.display = 'none';
      previewSection.classList.remove('active');
      document.getElementById('identifiedItemsBanner').style.display = 'none';
      fileInput.value = '';
      clearTimeout(regenerationTimeout);
      isRegenerating = false;
    });
    
    // Fiction Level Functions
    function updateFictionalLabel(level) {
      if (!fictionalLabel || !fictionalDescription) return;
      
      if (level <= 30) {
        fictionalLabel.textContent = `Authentic (${level}%)`;
        fictionalLabel.style.color = '#4CAF50';
        fictionalDescription.textContent = 'Enhance food quality while keeping original background';
      } else if (level <= 70) {
        fictionalLabel.textContent = `Balanced (${level}%)`;
        fictionalLabel.style.color = '#FF9800';
        fictionalDescription.textContent = 'Perfect food with subtle background improvements';
      } else {
        fictionalLabel.textContent = `Magical (${level}%)`;
        fictionalLabel.style.color = '#F44336';
        fictionalDescription.textContent = 'Create new restaurant setting with perfect food';
      }
    }
    
    // Initialize fiction level slider
    if (fictionalLevelSlider) {
      fictionalLevelSlider.value = fictionalLevel;
      updateFictionalLabel(fictionalLevel);
    }
    
    // Regenerate enhancement with new fiction level (reuses already-identified items)
    async function regenerateEnhancement() {
      if (!currentFile || isRegenerating) return;
      
      isRegenerating = true;
      processingDiv.style.display = 'block';
      document.getElementById('processingText').textContent = '‚ú® Re-enhancing with new settings‚Ä¶';
      document.getElementById('processingSubtext').textContent = 'Applying new intensity level';
      sliderContainer.style.display = 'none';
      actionsDiv.style.display = 'none';
      statusDiv.style.display = 'none';
      
      startProcessingTimer();
      
      try {
        const base64 = pendingBase64 || await fileToBase64(currentFile);
        const urlParams = new URLSearchParams(window.location.search);
        const restaurantId = urlParams.get('restaurant_id') || '1';
        
        const response = await fetch('/api/enhance-image', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            image: base64,
            filename: currentFile.name,
            restaurant_id: parseInt(restaurantId),
            style: 'upscale_casual',
            fictional_level: fictionalLevel,
            identified_items: confirmedItems // Reuses items from first identification
          })
        });
        
        const data = await response.json();
        stopProcessingTimer();
        
        if (!response.ok) {
          throw new Error(data.message || data.error || 'Enhancement failed');
        }
        
        afterImage.src = data.afterUrl || data.output[0];
        afterImageUrl = data.afterUrl || data.output[0];
        
        await waitForImages();
        processingDiv.style.display = 'none';
        sliderContainer.style.display = 'block';
        actionsDiv.style.display = 'flex';
        
      } catch (error) {
        stopProcessingTimer();
        console.error('Regeneration error:', error);
        showStatus(`Regeneration failed: ${error.message}`, 'error');
        processingDiv.style.display = 'none';
      } finally {
        isRegenerating = false;
      }
    }
    
    // Slider change handler with debounce
    if (fictionalLevelSlider) {
      fictionalLevelSlider.addEventListener('input', (e) => {
        const newLevel = parseInt(e.target.value);
        fictionalLevel = newLevel;
        localStorage.setItem('fictionalLevel', newLevel.toString());
        updateFictionalLabel(newLevel);
        
        // Debounced regeneration if image already enhanced
        if (afterImageUrl && !isRegenerating) {
          clearTimeout(regenerationTimeout);
          regenerationTimeout = setTimeout(() => {
            regenerateEnhancement();
          }, 600); // 600ms debounce
        }
      });
    }
    
    // Preset button handlers
    presetButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const level = parseInt(btn.dataset.level);
        fictionalLevel = level;
        if (fictionalLevelSlider) {
          fictionalLevelSlider.value = level;
        }
        localStorage.setItem('fictionalLevel', level.toString());
        updateFictionalLabel(level);
        
        // Regenerate if image already enhanced
        if (afterImageUrl && !isRegenerating) {
          regenerateEnhancement();
        }
      });
    });
    
    // ‚îÄ‚îÄ Processing timer ‚îÄ‚îÄ
    let processingTimer = null;
    let processingStartTime = 0;

    function startProcessingTimer() {
      processingStartTime = Date.now();
      const subtext = document.getElementById('processingSubtext');
      clearInterval(processingTimer);
      processingTimer = setInterval(() => {
        const elapsed = Math.floor((Date.now() - processingStartTime) / 1000);
        subtext.textContent = `${elapsed}s elapsed`;
      }, 1000);
    }

    function stopProcessingTimer() {
      clearInterval(processingTimer);
      processingTimer = null;
    }

    // ‚îÄ‚îÄ Enhance button: Fully automatic ‚Äî Identify ‚Üí Enhance ‚Üí Show ‚îÄ‚îÄ
    enhanceBtn.addEventListener('click', async () => {
      if (!currentFile) return;

      // ‚îÄ‚îÄ Free trial check ‚îÄ‚îÄ
      if (!hasTrialRemaining()) {
        openGate();
        return;
      }

      // Reset UI ‚Äî go straight to processing
      previewContainer.style.display = 'none';
      previewSection.classList.add('active');
      processingDiv.style.display = 'block';
      document.getElementById('processingText').textContent = 'üîç Identifying food items‚Ä¶';
      document.getElementById('processingSubtext').textContent = 'Analyzing your photo with AI vision';
      document.getElementById('identifiedItemsBanner').style.display = 'none';
      sliderContainer.style.display = 'none';
      actionsDiv.style.display = 'none';
      statusDiv.style.display = 'none';

      startProcessingTimer();

      try {
        const base64 = await fileToBase64(currentFile);
        pendingBase64 = base64;

        // ‚îÄ‚îÄ Step 1: Identify food items automatically ‚îÄ‚îÄ
        let identifiedItems = '';
        try {
          const controller = new AbortController();
          const timeout = setTimeout(() => controller.abort(), 60000);

          const idResponse = await fetch('/api/identify-food', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ image: base64 }),
            signal: controller.signal
          });
          clearTimeout(timeout);
          const idData = await idResponse.json();

          if (idData.identified && idData.description) {
            identifiedItems = idData.description;
            console.log('‚úÖ Auto-identified:', identifiedItems);
          } else {
            console.log('‚ö†Ô∏è Identification returned no results ‚Äî enhancing with prompt rules only');
          }
        } catch (idError) {
          console.warn('‚ö†Ô∏è Identification step failed (non-fatal):', idError.message);
          // Continue to enhancement without identified items
        }

        confirmedItems = identifiedItems;

        // ‚îÄ‚îÄ Step 2: Enhance the image ‚îÄ‚îÄ
        document.getElementById('processingText').textContent = '‚ú® Enhancing to Michelin-star quality‚Ä¶';
        document.getElementById('processingSubtext').textContent = 'Creating your perfect restaurant photo';

        const urlParams = new URLSearchParams(window.location.search);
        const restaurantId = urlParams.get('restaurant_id') || '1';

        const response = await fetch('/api/enhance-image', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            image: pendingBase64,
            filename: currentFile.name,
            restaurant_id: parseInt(restaurantId),
            style: 'upscale_casual',
            fictional_level: fictionalLevel,
            identified_items: confirmedItems
          })
        });

        const data = await response.json();
        stopProcessingTimer();

        if (!response.ok) {
          let errorMsg = data.message || data.error || `Enhancement failed (${response.status})`;
          if (response.status === 403) {
            errorMsg = 'Access forbidden. (1) API key issue, (2) Insufficient credits, or (3) Rate limit exceeded.';
          } else if (response.status === 401) {
            errorMsg = 'Authentication failed. Check your API key.';
          } else if (response.status === 402) {
            errorMsg = 'Insufficient credits. Add credits to your AI service.';
          }
          console.error('Enhancement API error:', { status: response.status, data });
          throw new Error(errorMsg);
        }

        // Show what was identified (from our detection or server-side)
        const items = confirmedItems || data.identifiedItems;
        if (items) {
          document.getElementById('identifiedItemsText').textContent = items;
          document.getElementById('identifiedItemsBanner').style.display = 'block';
        }

        // Show before/after results
        beforeImage.src = beforeImageUrl;
        afterImage.src = data.afterUrl || data.output[0];
        afterImageUrl = data.afterUrl || data.output[0];

        await waitForImages();

        processingDiv.style.display = 'none';
        sliderContainer.style.display = 'block';
        actionsDiv.style.display = 'flex';

        await initSlider();

        // Track usage for free trial
        incrementEnhanceCount();

        showStatus('‚úÖ Enhancement complete! Drag the slider to compare.', 'success');
        triggerConfetti();
      } catch (error) {
        stopProcessingTimer();
        processingDiv.style.display = 'none';
        showStatus(`‚ùå Error: ${error.message}`, 'error');
      }
    });
    
    // Download button
    downloadBtn.addEventListener('click', () => {
      if (!afterImageUrl) return;
      
      const link = document.createElement('a');
      link.href = afterImageUrl;
      link.download = `enhanced-${currentFile.name}`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
    
    // New photo button
    newPhotoBtn.addEventListener('click', () => {
      currentFile = null;
      beforeImageUrl = null;
      afterImageUrl = null;
      pendingBase64 = null;
      confirmedItems = '';
      stopProcessingTimer();
      previewContainer.style.display = 'none';
      previewSection.classList.remove('active');
      processingDiv.style.display = 'none';
      document.getElementById('identifiedItemsBanner').style.display = 'none';
      fileInput.value = '';
      statusDiv.style.display = 'none';
      cleanupSlider();
    });
    
    // Wait for images to load
    function waitForImages() {
      return Promise.all([
        new Promise((resolve) => {
          if (beforeImage.complete && beforeImage.naturalWidth > 0) {
            resolve();
          } else {
            beforeImage.onload = resolve;
            beforeImage.onerror = resolve; // Continue even if image fails
          }
        }),
        new Promise((resolve) => {
          if (afterImage.complete && afterImage.naturalWidth > 0) {
            resolve();
          } else {
            afterImage.onload = resolve;
            afterImage.onerror = resolve; // Continue even if image fails
          }
        })
      ]);
    }
    
    // Cleanup slider event listeners
    function cleanupSlider() {
      if (!sliderInitialized) return;
      
      // Remove all event listeners
      Object.keys(sliderEventHandlers).forEach(key => {
        const { element, event, handler } = sliderEventHandlers[key];
        if (element && handler) {
          element.removeEventListener(event, handler);
        }
      });
      
      // Reset state
      sliderEventHandlers = {};
      sliderInitialized = false;
      isDragging = false;
      currentSliderPosition = 50;
      sliderHandle.classList.remove('dragging');
      afterImage.classList.remove('no-transition');
    }
    
    // Initialize slider
    async function initSlider() {
      // Clean up existing slider if already initialized
      if (sliderInitialized) {
        cleanupSlider();
      }
      
      // Wait for images to load before initializing
      try {
        await waitForImages();
      } catch (error) {
        console.warn('Image load warning:', error);
      }
      
      isDragging = false;
      currentSliderPosition = 50;
      
      function updateSlider(position) {
        currentSliderPosition = Math.max(0, Math.min(100, position));
        sliderControl.style.left = currentSliderPosition + '%';
        afterImage.classList.add('no-transition');
        afterImage.style.clipPath = `inset(0 ${100 - currentSliderPosition}% 0 0)`;
      }
      
      // Prevent text selection on drag
      function preventSelection(e) {
        e.preventDefault();
        return false;
      }
      
      // Mouse drag start handler
      const handleMouseDown = (e) => {
        isDragging = true;
        sliderHandle.classList.add('dragging');
        sliderHandle.style.cursor = 'grabbing';
        e.preventDefault();
        e.stopPropagation();
        // Prevent text selection
        document.addEventListener('selectstart', preventSelection);
        document.body.style.userSelect = 'none';
        document.body.style.webkitUserSelect = 'none';
      };
      
      // Mouse move handler
      const handleMouseMove = (e) => {
        if (!isDragging) return;
        e.preventDefault();
        e.stopPropagation();
        const rect = sliderWrapper.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
        updateSlider(percent);
      };
      
      // Mouse up handler
      const handleMouseUp = () => {
        if (isDragging) {
          isDragging = false;
          sliderHandle.classList.remove('dragging');
          sliderHandle.style.cursor = 'grab';
          afterImage.classList.remove('no-transition');
          // Re-enable text selection
          document.removeEventListener('selectstart', preventSelection);
          document.body.style.userSelect = '';
          document.body.style.webkitUserSelect = '';
        }
      };
      
      // Touch start handler
      const handleTouchStart = (e) => {
        isDragging = true;
        sliderHandle.classList.add('dragging');
        e.preventDefault();
        e.stopPropagation();
      };
      
      // Touch move handler
      const handleTouchMove = (e) => {
        if (!isDragging) return;
        e.preventDefault();
        e.stopPropagation();
        const rect = sliderWrapper.getBoundingClientRect();
        const x = e.touches[0].clientX - rect.left;
        const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
        updateSlider(percent);
      };
      
      // Touch end handler
      const handleTouchEnd = () => {
        if (isDragging) {
          isDragging = false;
          sliderHandle.classList.remove('dragging');
          afterImage.classList.remove('no-transition');
        }
      };
      
      // Click on wrapper handler
      const handleWrapperClick = (e) => {
        // Don't trigger if clicking on handle, control, or icon
        const sliderIcon = sliderHandle.querySelector('.slider-icon');
        if (e.target === sliderHandle || e.target === sliderControl || e.target === sliderIcon || sliderHandle.contains(e.target) || sliderControl.contains(e.target)) {
          return;
        }
        const rect = sliderWrapper.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
        afterImage.classList.remove('no-transition');
        updateSlider(percent);
      };
      
      // Keyboard navigation handler
      const handleKeyDown = (e) => {
        // Only handle if slider is visible
        if (sliderContainer.style.display === 'none') return;
        
        // Don't interfere with typing in inputs
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
        
        let newPosition = currentSliderPosition;
        
        switch(e.key) {
          case 'ArrowLeft':
            e.preventDefault();
            newPosition = Math.max(0, currentSliderPosition - 5);
            afterImage.classList.remove('no-transition');
            updateSlider(newPosition);
            break;
          case 'ArrowRight':
            e.preventDefault();
            newPosition = Math.min(100, currentSliderPosition + 5);
            afterImage.classList.remove('no-transition');
            updateSlider(newPosition);
            break;
          case 'Home':
            e.preventDefault();
            afterImage.classList.remove('no-transition');
            updateSlider(0);
            break;
          case 'End':
            e.preventDefault();
            afterImage.classList.remove('no-transition');
            updateSlider(100);
            break;
        }
      };
      
      // Store handlers for cleanup
      sliderEventHandlers = {
        handleMouseDown: { element: sliderHandle, event: 'mousedown', handler: handleMouseDown },
        handleMouseMove: { element: document, event: 'mousemove', handler: handleMouseMove },
        handleMouseUp: { element: document, event: 'mouseup', handler: handleMouseUp },
        handleTouchStart: { element: sliderHandle, event: 'touchstart', handler: handleTouchStart },
        handleTouchMove: { element: document, event: 'touchmove', handler: handleTouchMove },
        handleTouchEnd: { element: document, event: 'touchend', handler: handleTouchEnd },
        handleWrapperClick: { element: sliderWrapper, event: 'click', handler: handleWrapperClick },
        handleKeyDown: { element: document, event: 'keydown', handler: handleKeyDown }
      };
      
      // Add event listeners
      sliderHandle.addEventListener('mousedown', handleMouseDown);
      sliderControl.addEventListener('mousedown', handleMouseDown);
      document.addEventListener('mousemove', handleMouseMove);
      document.addEventListener('mouseup', handleMouseUp);
      sliderHandle.addEventListener('touchstart', handleTouchStart, { passive: false });
      sliderControl.addEventListener('touchstart', handleTouchStart, { passive: false });
      document.addEventListener('touchmove', handleTouchMove, { passive: false });
      document.addEventListener('touchend', handleTouchEnd);
      sliderWrapper.addEventListener('click', handleWrapperClick);
      document.addEventListener('keydown', handleKeyDown);
      
      // Initialize position
      updateSlider(50);
      afterImage.classList.remove('no-transition');
      sliderInitialized = true;
    }
    
    // Helper functions
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
    
    function showStatus(message, type) {
      statusDiv.textContent = message;
      statusDiv.className = `status ${type}`;
      statusDiv.style.display = 'block';
    }
    
    function triggerConfetti() {
      // Simple confetti effect
      const colors = ['#4caf50', '#66bb6a', '#ffffff'];
      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.style.position = 'fixed';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.top = '-10px';
          confetti.style.width = '10px';
          confetti.style.height = '10px';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.borderRadius = '50%';
          confetti.style.pointerEvents = 'none';
          confetti.style.zIndex = '9999';
          confetti.style.animation = `fall ${Math.random() * 2 + 1}s linear`;
          document.body.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 3000);
        }, i * 20);
      }
      
      // Add fall animation
      if (!document.getElementById('confetti-style')) {
        const style = document.createElement('style');
        style.id = 'confetti-style';
        style.textContent = `
          @keyframes fall {
            to {
              transform: translateY(100vh) rotate(360deg);
              opacity: 0;
            }
          }
        `;
        document.head.appendChild(style);
      }
    }
  </script>

  <!-- Signup Gate Modal -->
  <div class="gate-overlay" id="gateOverlay">
    <div class="gate-card">
      <button class="gate-close" onclick="closeGate()">&times;</button>
      <div id="gateFormView">
        <h2>You've Used Your Free Trial!</h2>
        <p>Sign up and we'll contact you to set up a plan with <strong>unlimited</strong> photo enhancements.</p>
        <form class="gate-form" id="gateForm" onsubmit="submitGate(event)">
          <label for="gateName">Your Name</label>
          <input type="text" id="gateName" name="name" required placeholder="John Smith">
          <label for="gateEmail">Email Address</label>
          <input type="email" id="gateEmail" name="email" required placeholder="john@restaurant.com">
          <label for="gateRestaurant">Restaurant Name</label>
          <input type="text" id="gateRestaurant" name="restaurant" placeholder="Joe's Diner">
          <label for="gatePhone">Phone (optional)</label>
          <input type="tel" id="gatePhone" name="phone" placeholder="(555) 555-5555">
          <input type="hidden" name="feature" value="photo-enhancement">
          <button type="submit" class="gate-submit">Sign Up ‚Äî Unlock Unlimited Enhancements</button>
        </form>
      </div>
      <div class="gate-success" id="gateSuccessView">
        <div class="gate-success-icon">üéâ</div>
        <h3>You're All Set!</h3>
        <p class="gate-success-text">Thanks for signing up! We'll contact you within 24 hours to get your plan set up with unlimited enhancements.</p>
        <a href="/features.html#pricing" class="btn btn-primary gate-success-btn">View Plans</a>
      </div>
    </div>
  </div>

  <script>
    // ‚îÄ‚îÄ Free Trial Gate Logic ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const FREE_ENHANCE_LIMIT = 1;
    const TRIAL_KEY = 'mp_photo_enhances';

    function getEnhanceCount() {
      return parseInt(localStorage.getItem(TRIAL_KEY) || '0');
    }

    function incrementEnhanceCount() {
      const count = getEnhanceCount() + 1;
      localStorage.setItem(TRIAL_KEY, count.toString());
      updateTrialBanner();
      return count;
    }

    function hasTrialRemaining() {
      return getEnhanceCount() < FREE_ENHANCE_LIMIT;
    }

    function updateTrialBanner() {
      const banner = document.getElementById('trialBanner');
      const text = document.getElementById('trialBannerText');
      const used = getEnhanceCount();
      if (used >= FREE_ENHANCE_LIMIT) {
        banner.style.background = 'linear-gradient(135deg, #fce4ec, #ffebee)';
        banner.style.borderColor = '#ef9a9a';
        text.innerHTML = '‚ö° <span>Free trial used</span> ‚Äî Sign up to unlock unlimited enhancements!';
        text.style.color = '#c62828';
      } else {
        const remaining = FREE_ENHANCE_LIMIT - used;
        text.innerHTML = `üéâ <span>${remaining} Free Enhancement${remaining > 1 ? 's' : ''}</span> ‚Äî Try our AI photo magic, no sign-up needed!`;
      }
    }

    function openGate() {
      document.getElementById('gateFormView').style.display = 'block';
      document.getElementById('gateSuccessView').style.display = 'none';
      document.getElementById('gateOverlay').classList.add('active');
    }

    function closeGate() {
      document.getElementById('gateOverlay').classList.remove('active');
    }

    function submitGate(e) {
      e.preventDefault();
      const lead = {
        name: document.getElementById('gateName').value,
        email: document.getElementById('gateEmail').value,
        restaurant: document.getElementById('gateRestaurant').value,
        phone: document.getElementById('gatePhone').value,
        feature: 'photo-enhancement',
        date: new Date().toISOString()
      };
      const leads = JSON.parse(localStorage.getItem('mp_leads') || '[]');
      leads.push(lead);
      localStorage.setItem('mp_leads', JSON.stringify(leads));

      fetch('/api/leads/capture', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(lead)
      }).catch(() => {});

      document.getElementById('gateFormView').style.display = 'none';
      document.getElementById('gateSuccessView').style.display = 'block';
    }

    // Close modal on overlay click or Escape
    document.getElementById('gateOverlay').addEventListener('click', function(e) {
      if (e.target === this) closeGate();
    });
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeGate();
    });

    // Initialize banner on load
    updateTrialBanner();
  </script>
</body>
</html>
